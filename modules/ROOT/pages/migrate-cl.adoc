:experimental:
= Migrating from CoreOS Container Linux (CL) to Fedora CoreOS (FCOS)

Fedora CoreOS is the successor of CoreOS Container Linux, and current users of CL are encouraged to migrate to FCOS. This page attempts to document the differences between CL and FCOS to ease the transition to FCOS.

:toc:

== Introduction

To migrate from CL to FCOS, you must convert your old Container Linux Configs, Ignition configs, or `cloud-config` files to a xref:fcct-config.adoc[Fedora CoreOS Config (FCC)] and adapt the contents for FCOS. Since many of the configuration details have changed, you should reference this page and the https://github.com/coreos/fedora-coreos-tracker/issues/159[CL migration issue] on GitHub.

== Installation changes

The following changes have been made to the installation process:

* The `coreos-install` script has been replaced with https://github.com/coreos/coreos-installer[`coreos-installer`]. It offers similar functionality.
* The `coreos.autologin` kernel command-line parameter is not currently supported in FCOS.
* Certain CL platforms, such as Vagrant, are not yet supported in FCOS. Refer to the https://getfedora.org/coreos/download/[Download page] to see the available image types.

== Configuration changes

When writing FCC files, note the following changes:

* `coreos-metadata` is now https://github.com/coreos/afterburn/blob/master/README.md[Afterburn]. The prefix of the metadata variable names has changed from `COREOS_` to `AFTERBURN_`, and the following platform names have changed:
** `EC2` is now `AWS`
** `GCE` is now `GCP`

For more info, see the https://github.com/coreos/afterburn/blob/master/README.md[Afterburn readme].

* To deploy an Igntion config as part of a PXE image (a "custom OEM" in CL terminology), follow the https://coreos.com/os/docs/latest/booting-with-pxe.html#adding-a-custom-oem[same process] as in CL, but place the `config.ign` file in the root of the archive.
* For time synchronization, use https://docs.fedoraproject.org/en-US/fedora/rawhide/system-administrators-guide/servers/Configuring_NTP_Using_the_chrony_Suite/[`chronyd`] rather than `ntpd` or `systemd-timesyncd`.
* `etcd` is not included in FCOS. Refer to xref:running-containers.adoc[Running etcd] for instructions to run it as a container on FCOS.
* `flannel` is not included in FCOS.
* The functionality of the reboot manager (`locksmith`) is rolled into https://github.com/coreos/zincati/blob/master/README.md[Zincati].
* By default, FCOS does not allow password logins via SSH. We recommend configuring SSH keys instead.
* FCOS does not have a mechanism to select the version of docker.
* Because `usermod` is not yet fully-functional on FCOS, there is a `docker` group in the `/etc/group` file. This is a stop-gap measure to facilitate a smooth transition to FCOS. The team is working on a more functional `usermod`, at which time the `docker` group will no longer be included by default. See the https://github.com/coreos/fedora-coreos-tracker/issues/2[docker group issue].
* There is no way to create directories below the `/` directory. Changes are restricted to `/etc` and `/var`. Refer to the documentation for the xref:ign-storage.adoc[`storage`] node of the FCC configuration for details about writing directories and files to FCOS.

== Operator notes
* CL had three release channels: `alpha`, `beta`, and `stable`. The FCOS production https://github.com/coreos/fedora-coreos-tracker/blob/master/Design.md#release-streams[release streams] are `next`, `testing`, and `stable`, with somewhat different semantics. See the https://getfedora.org/coreos/download/[download page] for more info.
* Automatic updates are now coordinated by Zincati, as described in the https://github.com/coreos/zincati/blob/master/docs/usage/auto-updates.md[Zincati documentation]. The rollback mechanism (via grub) is now provided by https://github.com/coreos/rpm-ostree/blob/master/README.md[`rpm-ostree`].
* The `update-ssh-keys` tool is not provided on FCOS. To update SSH keys, edit `~/ssh/authorized_keys` directly. Note that Ignition and Afterburn place SSH keys in separate files in `~/.ssh/authorized_keys.d`.
* In general, SELinux confinement should work the same as in Fedora.
* In CL, metrics/telemetry data was collected by the update mechanism. In FCOS, the data is collected (without unique identifiers) by https://github.com/coreos/fedora-coreos-pinger/issues/30[`fedora-coreos-pinger`].
** To prevent any information from being collected or transmitted by the pinger, you can disable reporting. To do so, drop a config snippet into `/etc/fedora-coreos-pinger/config.d/99-disable-reporting.toml` containing the following:
+
[source]
----
[reporting]
enabled = false
----
* Cloud CLI clients are not included in FCOS. There is an initiative to create a "tools" container to run on FCOS.
* When opening an existing file in a sticky directory, the behavior differs from CL. See https://github.com/coreos/bugs/issues/2577.
* CL left Simultaneous Multi-Threading (SMT) enabled but advised users to turn it off if their systems were vulnerable to certain issues such as https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/l1tf.html[L1TF] or https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/mds.html[MDS]. By default, FCOS https://github.com/coreos/fedora-coreos-tracker/issues/181[automatically disables SMT] for vulnerable systems.

== Implementation notes
//* Partition layout differences. CL is at https://coreos.com/os/docs/latest/sdk-disk-partitions.html. I can't make heads or tails of the results of the discussions in https://github.com/coreos/fedora-coreos-tracker/issues/94.
* The default filesystem on CL was `ext4`. On FCOS, the default is `xfs`.
* While CL used systemd socket activation for `sshd`, FCOS starts `sshd` at startup by default.
* CL had an "OEM partition" at `/usr/share/oem` with a user-customizable GRUB config and some additional tools, but FCOS does not have this.
//* Filesystem resizing differences. Need more info on FCOS side.
